<!DOCTYPE html>
<html>

<style>
	hide{
    display: none;	
    }
	table{
    width: 100%;
    }
 	th,td {
		border: 0px solid black;
		border-collapse: collapse;
		text-align: left;
		padding: 5px; 
	}
	tr:nth-child(even) {background-color: #E5E8E8;}
	tr:hover {background-color:#AEB6BF;}

	.category {
		font-size:12pt;
		font-weight: 600;
		background:silver;
		}

	.gray-bg {
  		background-color: gray;
	}
	.green-bg {
  		background-color: green;
	}
	.red-bg {
  		background-color: red;
		}

	.red{
		color:red;}
 	.numberbox{
     	font-size:10pt;
     	width:100px;
    	}
</style>

<head>
 
</head>

<body>

<p>充能斧期望值計算機Calculate the expected output of charge bladet:</p>

<p class = "category"> &nbsp;武器面板數值 Weapon stat: </p>

<p>	攻擊 Attack: <input type="number" id="phy" value="198" maxlength="5" class="numberbox">

			&nbsp;&nbsp;&nbsp;

	斬味 Sharpness:
	<select id="sharpness">
    	<optgroup label="Sharpness">
    	<option value="0">Yellow</option>
    	<option value="1">Green</option>
    	<option value="2">Blue</option>
    	<option value="3">White</option>
	</select>
	</p>

	<p>屬性 Element:
	<select id="element type" onchange="check()">
    	<optgroup label="Element">
    	<option value="0">無 None</option>
    	<option value="1">火 Fire</option>
    	<option value="2">水 Water</option>
    	<option value="3">冰 Ice</option>
    	<option value="4">霤 Thunder</option>
    	<option value="5">龍 Dragon</option>
	</select>

&nbsp;&nbsp;&nbsp;

屬性值 Value:
<input type="var" id="element value" value="0" maxlength="5" readonly="true" style= color:grey class="numberbox"> </p>


<p>會心 Affinity:
	<input type="number" id="critical" value="40" min="-100" max="100" 
	onKeyUp="if(this.value>100){this.value='100';}else if(this.value<-100){this.value='-100';}">
	&nbsp;&nbsp;&nbsp;

	瓶種類 Phial Type:
	<select id="phial">
    	<optgroup label="Phial type">
    	<option value="0">榴彈瓶 Impact Phial</option>
    	<option value="1">強屬性瓶 Power Element Phial</option>
  	</select>
</p>


<p class= "category">&nbsp;技能 Skill</p>
<!-- Skill:ATK -->
<select id="attack lv">
    <optgroup label="攻擊Attack Boost">
    <option value="0">Attack Boost</option>
    <option value="1">Attack Lv1</option>
    <option value="2">Attack Lv2</option>
    <option value="3">Attack Lv3</option>
    <option value="4">Attack Lv4</option>
    <option value="5">Attack Lv5</option>
    <option value="6">Attack Lv6</option>
    <option value="7">Attack Lv7</option>
</select>
    
<select id="critical lv">
    <optgroup label="看破Critical Eye">
    <option value="0">Critical Eye</option>
    <option value="1">Critical Lv1</option>
    <option value="2">Critical Lv2</option>
    <option value="3">Critical Lv3</option>
    <option value="4">Critical Lv4</option>
    <option value="5">Critical Lv5</option>
    <option value="6">Critical Lv6</option>
    <option value="7">Critical Lv7</option>
</select>

<select id="weakness exploit">
    <optgroup label="弱點特效Weakness Exploit">
    <option value="0">Weakness Exploit</option>
    <option value="1">Weakness Exploit Lv1</option>
    <option value="2">Weakness Exploit Lv2</option>
    <option value="3">Weakness Exploit Lv3</option>
    </select>  

<select id="critical boost">
    <optgroup label="超會心Critical Boost">
    <option value="0">Critical Boost</option>
    <option value="1">Boost Lv1</option>
    <option value="2">Boost Lv2</option>
    <option value="3">Boost Lv3</option>
</select>
</p>
<p>
<select id="bludgeoner">
    <optgroup label="鈍器能手Bludgeoner">
    <option value="lv0">Bludgeoner</option>
    <option value="lv1">Bludgeoner Lv1</option>
    <option value="lv2">Bludgeoner Lv2</option>
    <option value="lv3">Bludgeoner Lv3</option>
</select>
    
<select id="challenger">
    <optgroup label="挑戰者Agitator">
    <option value="0">Agitator</option>
    <option value="1">Agitator Lv1</option>
    <option value="2">Agitator Lv2</option>
    <option value="3">Agitator Lv3</option>
    <option value="4">Agitator Lv4</option>
    <option value="5">Agitator Lv5</option>
    </select>

<select id="artillery">
    <optgroup label="炮術Artillery">
    <option value="0">Artillery</option>
    <option value="1">Artillery Lv1</option>
    <option value="2">Artillery Lv2</option>
    <option value="3">Artillery Lv3</option>
    </select>
    
   	<select id="rapid">
    	<optgroup label="高速變形Rapid Morph">
    	<option value="0">Rapid Morph</option>
    	<option value="1">Rapid Morph Lv1</option>
    	<option value="2">Rapid Morph Lv2</option>
    	<option value="3">Rapid Morph Lv3</option>
    </select>
    
</p>

<p>
<select id="fire element">
    <optgroup label="屬性攻擊強化Fire Attack">
    <option value="0">Fire Attack</option>
    <option value="1">Fire Attack Lv1</option>
    <option value="2">Fire Attack Lv2</option>
    <option value="3">Fire Attack Lv3</option>
    <option value="4">Fire Attack Lv4</option>
    <option value="5">Fire Attack Lv5</option>
    </select>
    
<select id="critical element">
    <optgroup label="屬性會心Critical Element">
    <option value="0">Critical Element</option>
    <option value="1">Critical Element Lv1</option>
    <option value="2">Critical Element Lv2</option>
    <option value="3">Critical Element Lv3</option>
    </select>
</p>

<p class= "category">&nbsp;物品 Item</p>
    <p>力量之爪<input type="checkbox" id="claw" value = "9" checked=true> 
 	力量護符<input type="checkbox" id="lace" value = "6" checked=true> </p>
    
<p class= "category">&nbsp;其他 Other</p>
	<p>	紅盾<input type="checkbox" id="shield"> 
    鬼火鳥: <input type="var" id="bird" value="20" maxlength="3" class="numberbox">

	<!--<input type="checkbox" id="drum"> 強化太鼓</p>-->
    </p>
    
<p class= "category">&nbsp;肉質</p>

	<p>魔物:
    <select id="meat" onchange="check2()">
    	<optgroup label="魔物">
    	<option value="0">訓練場機械娃(頭部)</option>
        <option value="1">自訂</option>
    	</select>
    </p>
   
<p>	物理肉質: <input type="var" id="physical meat" value="100" maxlength="3" readonly="true" style= color:grey class="numberbox">


	屬性肉質: <input type="var" id="element meat" value="30" maxlength="3" readonly="true" style= color:grey class="numberbox"> </p>
    
<p><button onClick="Getnumber();"/>計算</button></p>


<p class="category"> &nbsp; 面板數值</p>

<table>
	<tr>
		<td> Attack : <output id="out1"> </td>
		<td> Affinity : <output id="out2" > </td>
        <td> Element : <output id="out3"> </td>
    </tr>
    <tr>
    	<td> Expected output : <output id="out4"> </td>
		<td> physical damage : <output id="out5"> </td>
        <td> elemental damage : <output id="out6" class="red"> </td>
    </tr>
</table>
		Remark : 期望值未有計算肉質，技能:高速變形未加入<output id="out7">
<p id = "show1"> </p>
<p>		<table id="demo1"> 
        </table></p>
<p>		<table id="demo2"> 
		</table></p>
<p>		<table id="demo3"> 
		</table></p>

<script>

function check(){
	if (document.getElementById("element type").value == 0){
		document.getElementById('element value').readOnly = true; 
		document.getElementById('element value').value = 0;
		document.getElementById('element value').style.color = "grey"; }
 
	else{
		document.getElementById('element value').readOnly = false; 
		document.getElementById('element value').style.color = "black"; }
    }

function check2(){
	if (document.getElementById("meat").value == 0){
		document.getElementById("physical meat").readOnly = true;
        document.getElementById("element meat").readOnly = true; 
		document.getElementById("physical meat").value = 100;
        document.getElementById("element meat").value = 30;
		document.getElementById("physical meat").style.color = "grey";
        document.getElementById("element meat").style.color = "grey";}
 
	else if (document.getElementById("meat").value == 1){
		document.getElementById("physical meat").readOnly = false; 
		document.getElementById("physical meat").style.color = "black";
        document.getElementById("element meat").readOnly = false; 
		document.getElementById("element meat").style.color = "black";}
    }

function Getnumber() {

	var phy = parseFloat(document.getElementById("phy").value);
	var ele = parseFloat(document.getElementById("element value").value);
	var crit = parseFloat(document.getElementById("critical").value);
	var boost = parseFloat(document.getElementById("critical boost").value);
	var elecrit = parseFloat(document.getElementById("critical element").value);
	var pmeat = parseFloat(document.getElementById("physical meat").value);
	var emeat = parseFloat(document.getElementById("element meat").value);
	var bird = parseFloat(document.getElementById("bird").value);
// Skill:Colour 
	var sharpness= document.getElementById("sharpness").value;
	var pcolourarray = [1,1.05,1.2,1.32];
	var ecolourarray = [0.75,1,1.0625,1.125];
	var pcolour = pcolourarray[sharpness];
	var ecolour = ecolourarray[sharpness];

// Skill:Attack
	var atklv = document.getElementById("attack lv").value;
	var fixatkarray = [0,3,6,9,7,8,9,10];
	var atkboostarray = [1,1,1,1,1.05,1.06,1.08,1.1];
	var fixatk= fixatkarray[atklv];
	var atkboost= atkboostarray[atklv];

//Skill:Critical
	var critlv = document.getElementById("critical lv").value;
	var critarray = [0,5,10,15,20,25,30,40];
	var critadd= critarray[critlv];

//Skill:Weakness Exploit
	if (pmeat >44){
		var welv = document.getElementById("weakness exploit").value;
		var wearray = [0,15,30,50];
		var weadd= wearray[welv];}
	else {
		weadd = 0;}

//Skill:Bludgeoner
	var bludgeoner = document.getElementById("bludgeoner").value;
		if (bludgeoner == "lv1" && sharpness == "0"){
			bludgeoner = 1.05;
			}
		else if (bludgeoner == "lv2" && sharpness == "0" ){
				bludgeoner = 1.1;
			}
		else if (bludgeoner == "lv3" && (sharpness == "0" || sharpness == "1" )){
				bludgeoner = 1.1;
			}
		else {
				bludgeoner = 1;
			}

// Skill:Challenger/Agitator
	var chalv = document.getElementById("challenger").value;
	var chaatkarray = [0,4,8,12,16,20];
	var chacritarray = [0,3,5,7,10,15];
	var chaatk= chaatkarray[chalv];
	var chacrit= chacritarray[chalv];

//Skill:Artillery
	var artlv = document.getElementById("artillery").value;
	var artarray = [1,1.1,1.2,1.3];
	var art= artarray[artlv];

//Skill:Rapid Morph
	var raplv = document.getElementById("rapid").value;
	var raparray = [1,1,1.1,1.2];
	var rapid= raparray[raplv];

// Skill:Fire attack
	var elelv = document.getElementById("fire element").value;
	var eleatkarray = [0,2,3,4,4,4];
	var eleboostarray = [1,1,1,1.05,1.1,1.2];
	var fixele= eleatkarray[elelv];
	var eleboost= eleboostarray[elelv];

//item
	var claw = document.getElementById("claw");
	var lace = document.getElementById("lace");
		if (claw.checked == true){
			claw = parseInt(claw.value);}
		else {
			claw = 0;}
		if (lace.checked == true){
			lace = parseInt(lace.value);}
		else {
			lace = 0;}

//other
	var shield = document.getElementById("shield");
		if (shield.checked == true){
			shield = 1.1;}
		else {
			shield = 1;}

physical(crit,critadd,chacrit,weadd,lace,claw,phy,atkboost,bludgeoner,rapid,fixatk,chaatk,pcolour,boost,art,ecolour,elecrit,ele,eleboost,fixele,pmeat,emeat,shield,bird);
}

function physical(crit,critadd,chacrit,weadd,lace,claw,phy,atkboost,bludgeoner,rapid,fixatk,chaatk,pcolour,boost,art,ecolour,elecrit,ele,eleboost,fixele,pmeat,emeat,shield,bird){

	var basecrit = crit + critadd + chacrit;
    	if (basecrit>100){
    		basecrit = 100;
            //document.getElementById("out2").className = "red";
            //document.getElementById("out7").innerHTML = "Affinity over 100%"
            }
    	if (basecrit<-100){
    		basecrit = -100;}
	var finalcrit = crit + critadd + chacrit + weadd;
    	if (finalcrit>100){
    		finalcrit = 100;
            //document.getElementById("out2").className = "red";
            }
    	if (finalcrit<-100){
    		finalcrit = -100;}
	var item = lace + claw;
	var firstclassatk = atkboost*bludgeoner;//skill and weapon skill
	var fixatkadd = item + fixatk + chaatk + bird; //and seed or rice
	var secondclassatk = pcolour*finalcrit/100*(0.25+0.05*boost)+1;
    var atkbefore = phy*firstclassatk;
	var basedmg = Math.floor(atkbefore+fixatkadd+0.1);
	var pdmg = basedmg *secondclassatk;

//element damage calculation
	var secondclassele = ecolour*finalcrit/100*(0.05*elecrit)+1;
	var baseele = Math.floor(ele*eleboost+fixele+0.1);
	var edmg = baseele*secondclassele;

	var dmg = pdmg+edmg;
    
//part atk

  		document.getElementById("out1").innerHTML = basedmg;
  		document.getElementById("out2").innerHTML = basecrit;
  		document.getElementById("out3").innerHTML = baseele;
  		document.getElementById("out4").innerHTML = dmg.toFixed(2);
  		document.getElementById("out5").innerHTML = pdmg.toFixed(2);
 		document.getElementById("out6").innerHTML = edmg.toFixed(2);

    var p = document.getElementById("phial").value;
 		
       tablesword(shield,rapid,basedmg/100,baseele,finalcrit,boost,elecrit,pmeat/100,emeat/100,pcolour,ecolour);    		tableaxe(shield,rapid,basedmg/100,baseele,finalcrit,boost,elecrit,pmeat/100,emeat/100,pcolour,ecolour);
  	if (p == 0){
    	tableImpactPhial(basedmg/100,art,shield);}
    else if (p ==1){
    	tableElementPhial(basedmg/100,baseele,emeat/100,shield);}
}  


//Damage calculation of sword attack
function tablesword(shield,rapid,BaseDamage,e,c,b,eb,pmeat,emeat,pcolour,ecolour){
//Define move and motion value
	var a = [];
	var move = ["Weak Slash(x)","Return Stroke(x)","Spinning Slash(x)","Charged Rising Slash(a)",
"Charged Double Slash(1st hit)","Charged Double Slash(2nd hit)","Forward Slash(xa)","Shield Thrust(xa,1st hit)","Shield Thrust(xa,2nd hit)","Sliding Slash(→a)","Condensed Element Slash","Morph Slash(morphs to sword)","Morph Slash(to sword反擊特化)"];
    var mv = [12,15,28,13,27,18,20,12,8,25,75,28,35];
    var skillbuff = [1,1,1,1,1,1,1,1*shield,1*shield,1,1,1*rapid,1*rapid]
	var ele = [];
	var phy = [];
    var total = [];
    var critdmg = [];
//Physical, Element and Critical calculation
	for (var j=0;j<move.length;j++){
			ele[j] = e*emeat*ecolour;}
	for (var k=0;k<move.length;k++){
    		phy[k] = mv[k]*BaseDamage*pmeat*pcolour*skillbuff[k];
		}
//Red shield buff to shield Thrust
	//for (var k=7;k<9;k++){
    //		phy[k] = mv[k]*BaseDamage*pmeat*pcolour*shield;
	//	}
	for (var k=0;k<move.length;k++){
			total[k]=parseFloat(phy[k].toFixed(0))+parseFloat((ele[k]).toFixed(0));
		}
	for (var i=0;i<move.length;i++){
			critdmg[i]=parseFloat((phy[i]*(1.25+0.05*b)).toFixed(0))+parseFloat((ele[i]*(1+0.05*eb)).toFixed(0));
		}
	a.push(move,critdmg,total,phy,ele,mv);
    for (var i=1;i<a.length-1;i++){
    	for (var j=0;j<move.length;j++){
    		a[i][j] = parseFloat(a[i][j]).toFixed(0);}}
//generate table
	var table = "<th>"+ "Move" + "</th><th>" + "Total Damage" + "<br>" +"(Critical) " + c + "%</th><th>" + "Total Damage" + "<br>" + "(Non critical)" + "</th><th>" + "Physical Damage"+ "</th><th>" + "Element Damage" + "</th><th>"+ "Motion Value" +"</th>";

	for (var i=0;i<move.length;i++){
		table += "<tr><td>"+ a[0][i] + "</td><td>" + a[1][i] + "</td><td>"+ a[2][i] + "</td><td>"+ a[3][i] + "</td><td>"+ a[4][i] + "</td><td>"+ a[5][i] + "</td></tr>";
		}
		document.getElementById("demo1").innerHTML = "<b><p style= color:#21618C;font-size:20px;>Sword Damage  <button onClick = hideswordtable()>Hide</button></p>"+table+"<p style=font-size:14px;>**Remarks</p>";
}

//Damage calculation of axe attack
function tableaxe(shield,rapid,BaseDamage,e,c,b,eb,pmeat,emeat,pcolour,ecolour){
//Define move and motion value

    var a = [];
	var move = ["SAED (1st hit)","SAED (2nd hit)","SAED (3rd hit)","AED",
"Elemental Discharge I","Elemental Discharge II first hit","Elemental Discharge II second hit",
"Rising Slash","Overhead Slash","Dash Slam(↑+x)","Condensed Spinning Slash(charge+x)",
"Sword Morph Slash (morphs to Axe)","Morph Slash(to axe反擊特化)","Condensed Spinning Slash(1hit)","Condensed Spinning Slash(7hit)"];
	var mv = [15,90,72,90,21,30,46,35,37,45,30,37,44,7,49];
    var skillbuff = [1,1,1,1,1,1,1,1,1,1,1,1*rapid,1*rapid,1,1];
	var ele = [];
	var phy = [];
    var total = [];
    var critdmg = [];
//Physical, Element and Critical calculation
	for (var j=0;j<move.length;j++){
			ele[j] = e*emeat*ecolour;}
    for (var j=move.length-2;j<move.length;j++){
			ele[j] = e*0.3*emeat*ecolour;}
	for (var k=0;k<move.length;k++){
    		phy[k] = mv[k]*BaseDamage*pmeat*pcolour*shield*skillbuff[k];
		}
	for (var k=0;k<move.length;k++){
			total[k]=parseFloat(phy[k].toFixed(0))+parseFloat((ele[k]).toFixed(0));
		}
	for (var i=0;i<move.length;i++){
			critdmg[i]=parseFloat((phy[i]*(1.25+0.05*b)).toFixed(0))+parseFloat((ele[i]*(1+0.05*eb)).toFixed(0));
		}
	a.push(move,critdmg,total,phy,ele,mv);
    for (var i=1;i<a.length-1;i++){
    	for (var j=0;j<move.length;j++){
    		a[i][j] = parseFloat(a[i][j]).toFixed(0);}}
//generate table
	var table = "<th>"+ "Move" + "</th><th>" + "Total Damage" + "<br>" +"(Critical) " + c + "%</th><th>" + "Total Damage" + "<br>" + "(Non critical)" + "</th><th>" + "Physical Damage"+ "</th><th>" + "Element Damage" + "</th><th>"+ "Motion Value" +"</th>";

	for (var i=0;i<move.length;i++){
		table += "<tr><td>"+ a[0][i] + "</td><td>" + a[1][i] + "</td><td>"+ a[2][i] + "</td><td>"+ a[3][i] + "</td><td>"+ a[4][i] + "</td><td>"+ a[5][i] + "</td></tr>";
		}
		document.getElementById("demo2").innerHTML = "<b><p style= color:#21618C;font-size:20px;>Axe Damage</p>"+table+"<p style=font-size:14px;>**紅盾補正斧傷1.1倍</p>";
		}

//ImpactPhial Calculation

function tableImpactPhial(BaseDamage,art,shield){

var buff;
if (shield == 1.1){
var mv=[20,7*1.32,4*1.32,4.4,4,5];}
else{
var mv=["NA",7,4,"NA","NA","NA"];}

var a = [];
var move = ["Super Amped Element Discharge","Amped Element Discharge","Element Discharge I/II","Shield Thrust(紅盾狀態)","Sword(紅劍狀態)","Counter(GP)(紅盾狀態)"];

var phial = "Impact Phial";
var dmg = []
for(i=0;i<move.length;i++){
	dmg[i] = (mv[i]*BaseDamage*art).toFixed(0);}
a.push(move,dmg,mv);

var table = "<th>Move" + "</th><th>" + "Damage(Physical)" + "</th><th>"+ "Motion Value" +"</th>";

for (var i=0;i<move.length;i++){
table += "<tr><td>"+ a[0][i] + "</td><td>" + a[1][i] + "</td><td>"+ a[2][i] +"</td></tr>";
}
document.getElementById("demo3").innerHTML = "<b><p style= color:#21618C;font-size:20px;>Phial Damage(" + phial + ")</p>"+"<p>**榴彈瓶無視肉質</p>"+table+"<p style=font-size:14px;>**紅盾補正榴彈瓶1.2倍(超解無補正)</p>";
}


function tableElementPhial(BaseDamage,baseele,emeat,shield){
	var buff;
	if (shield == 1.1){
		var elemv = [7,5*1.3,2*1.3,1.5,1.5,2,1];
        var phymv = [1,1.1,1.1,1.1,1,1,1]}
	else{
		var elemv = ["NA",5,2,"NA","NA","NA","NA"];
        var phymv = [1,1,1,1,1,1,1]}

	var a = [];
	var move = ["Super Amped Element Discharge","Amped Element Discharge","Element Discharge I/II","Shield Thrust(紅盾狀態)","Sword(紅劍狀態)","Condensed Element Slash(紅劍)","Counter(GP)(紅盾狀態)"];
	var phial = "Element Phial";
    var phy = [];
    var ele = [];
	var total = [];
	for (var j=0;j<move.length;j++){
		total[j]=(((phymv[j]*BaseDamage).toFixed(0))*1+((elemv[j]*baseele*emeat).toFixed(0))*1).toFixed(0);
		}
	a.push(move,total,elemv);

	var table = "<th>Move" + "</th><th>" + "Damage(Element)" + "</th><th>"+ "Motion Value" +"</th>";

	for (var i=0;i<move.length;i++){
		table += "<tr><td>"+ a[0][i] + "</td><td>" + a[1][i] + "</td><td>"+ a[2][i] +"</td></tr>";
		}
		document.getElementById("demo3").innerHTML = "<b><p style= color:#21618C;font-size:20px;>Phial 		Damage(" + phial + ")</p>"+table+"<p style=font-size:14px;>**紅盾補正屬性瓶1.3倍</p>";
	}

//Button hide and show
function hideswordtable() {
	 document.getElementById("show1").innerHTML = "<button onclick = showswordtable()  >Show Sword Table</button>";
     document.getElementById('demo1').style.display = "none";
    document.getElementById("show1").style.display = "block";
  }
function showswordtable(){
      document.getElementById("demo1").style.display = "block";
      document.getElementById("show1").style.display = "none";	
}

</script>



</body></html>